"use strict";(self.webpackChunkol_mapbox_style=self.webpackChunkol_mapbox_style||[]).push([[497],{1922:(e,t,n)=>{n(8508);var r=n(316),i=Math.pow,o=(e,t,n)=>new Promise(((r,i)=>{var o=e=>{try{a(n.next(e))}catch(e){i(e)}},s=e=>{try{a(n.throw(e))}catch(e){i(e)}},a=e=>e.done?r(e.value):Promise.resolve(e.value).then(o,s);a((n=n.apply(e,t)).next())})),s=Uint8Array,a=Uint16Array,c=Int32Array,l=new s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),u=new s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),h=new s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(e,t){for(var n=new a(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];var i=new c(n[30]);for(r=1;r<30;++r)for(var o=n[r];o<n[r+1];++o)i[o]=o-n[r]<<5|r;return{b:n,r:i}},d=f(l,2),g=d.b,p=d.r;g[28]=258,p[258]=28;var y,m=f(u,0),w=m.b,v=(m.r,new a(32768));for(D=0;D<32768;++D)y=(61680&(y=(52428&(y=(43690&D)>>1|(21845&D)<<1))>>2|(13107&y)<<2))>>4|(3855&y)<<4,v[D]=((65280&y)>>8|(255&y)<<8)>>1;var x=function(e,t,n){for(var r=e.length,i=0,o=new a(t);i<r;++i)e[i]&&++o[e[i]-1];var s,c=new a(t);for(i=1;i<t;++i)c[i]=c[i-1]+o[i-1]<<1;if(n){s=new a(1<<t);var l=15-t;for(i=0;i<r;++i)if(e[i])for(var u=i<<4|e[i],h=t-e[i],f=c[e[i]-1]++<<h,d=f|(1<<h)-1;f<=d;++f)s[v[f]>>l]=u}else for(s=new a(r),i=0;i<r;++i)e[i]&&(s[i]=v[c[e[i]-1]++]>>15-e[i]);return s},b=new s(288);for(D=0;D<144;++D)b[D]=8;for(D=144;D<256;++D)b[D]=9;for(D=256;D<280;++D)b[D]=7;for(D=280;D<288;++D)b[D]=8;var D,U=new s(32);for(D=0;D<32;++D)U[D]=5;var L=x(b,9,1),T=x(U,5,1),E=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},C=function(e,t,n){var r=t/8|0;return(e[r]|e[r+1]<<8)>>(7&t)&n},z=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],A=function(e,t,n){var r=new Error(t||M[e]);if(r.code=e,Error.captureStackTrace&&Error.captureStackTrace(r,A),!n)throw r;return r},O=function(e,t,n,r){var i=e.length,o=r?r.length:0;if(!i||t.f&&!t.l)return n||new s(0);var a=!n||2!=t.i,c=t.i;n||(n=new s(3*i));var f=function(e){var t=n.length;if(e>t){var r=new s(Math.max(2*t,e));r.set(n),n=r}},d=t.f||0,p=t.p||0,y=t.b||0,m=t.l,v=t.d,b=t.m,D=t.n,U=8*i;do{if(!m){d=C(e,p,1);var M=C(e,p+1,3);if(p+=3,!M){var O=e[(I=4+((p+7)/8|0))-4]|e[I-3]<<8,$=I+O;if($>i){c&&A(0);break}a&&f(y+O),n.set(e.subarray(I,$),y),t.b=y+=O,t.p=p=8*$,t.f=d;continue}if(1==M)m=L,v=T,b=9,D=5;else if(2==M){var B=C(e,p,31)+257,H=C(e,p+10,15)+4,Z=B+C(e,p+5,31)+1;p+=14;for(var P=new s(Z),k=new s(19),V=0;V<H;++V)k[h[V]]=C(e,p+3*V,7);p+=3*H;var R=E(k),j=(1<<R)-1,S=x(k,R,1);for(V=0;V<Z;){var I,N=S[C(e,p,j)];if(p+=15&N,(I=N>>4)<16)P[V++]=I;else{var W=0,J=0;for(16==I?(J=3+C(e,p,3),p+=2,W=P[V-1]):17==I?(J=3+C(e,p,7),p+=3):18==I&&(J=11+C(e,p,127),p+=7);J--;)P[V++]=W}}var K=P.subarray(0,B),_=P.subarray(B);b=E(K),D=E(_),m=x(K,b,1),v=x(_,D,1)}else A(1);if(p>U){c&&A(0);break}}a&&f(y+131072);for(var q=(1<<b)-1,F=(1<<D)-1,G=p;;G=p){var X=(W=m[z(e,p)&q])>>4;if((p+=15&W)>U){c&&A(0);break}if(W||A(2),X<256)n[y++]=X;else{if(256==X){G=p,m=null;break}var Q=X-254;if(X>264){var Y=l[V=X-257];Q=C(e,p,(1<<Y)-1)+g[V],p+=Y}var ee=v[z(e,p)&F],te=ee>>4;if(ee||A(3),p+=15&ee,_=w[te],te>3&&(Y=u[te],_+=z(e,p)&(1<<Y)-1,p+=Y),p>U){c&&A(0);break}a&&f(y+131072);var ne=y+Q;if(y<_){var re=o-_,ie=Math.min(_,ne);for(re+y<0&&A(3);y<ie;++y)n[y]=r[re+y]}for(;y<ne;y+=4)n[y]=n[y-_],n[y+1]=n[y+1-_],n[y+2]=n[y+2-_],n[y+3]=n[y+3-_];y=ne}}t.l=m,t.p=G,t.b=y,t.f=d,m&&(d=1,t.m=b,t.d=v,t.n=D)}while(!d);return y==n.length?n:function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var r=new s(n-t);return r.set(e.subarray(t,n)),r}(n,0,y)},$=new s(0),B=function(e){31==e[0]&&139==e[1]&&8==e[2]||A(6,"invalid gzip data");var t=e[3],n=10;4&t&&(n+=2+(e[10]|e[11]<<8));for(var r=(t>>3&1)+(t>>4&1);r>0;r-=!e[n++]);return n+(2&t)},H=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},Z=function(e,t){return(8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31)&&A(6,"invalid zlib data"),(e[1]>>5&1)==+!t&&A(6,"invalid zlib data: "+(32&e[1]?"need":"unexpected")+" dictionary"),2+(e[1]>>3&4)};function P(e,t){return 31==e[0]&&139==e[1]&&8==e[2]?function(e,t){var n=B(e);return n+8>e.length&&A(6,"invalid gzip data"),O(e.subarray(n,-8),{i:2},t&&t.out||new s(H(e)),t&&t.dictionary)}(e,t):8!=(15&e[0])||e[0]>>4>7||(e[0]<<8|e[1])%31?function(e,t){return O(e,{i:2},t&&t.out,t&&t.dictionary)}(e,t):function(e,t){return O(e.subarray(Z(e,t&&t.dictionary),-4),{i:2},t&&t.out,t&&t.dictionary)}(e,t)}var k="undefined"!=typeof TextDecoder&&new TextDecoder;try{k.decode($,{stream:!0})}catch(e){}var V=(e,t)=>e*i(2,t),R=(e,t)=>Math.floor(e/i(2,t)),j=(e,t)=>V(e.getUint16(t+1,!0),8)+e.getUint8(t),S=(e,t)=>V(e.getUint32(t+2,!0),16)+e.getUint16(t,!0),I=(e,t,n,r,i)=>{if(e!==r.getUint8(i))return e-r.getUint8(i);const o=j(r,i+1);if(t!==o)return t-o;const s=j(r,i+4);return n!==s?n-s:0},N=(e,t,n,r)=>{const i=W(e,t,n,r);return i?{z:t,x:n,y:r,offset:i[0],length:i[1],isDir:!1}:null},W=(e,t,n,r)=>{let i=0,o=e.byteLength/17-1;for(;i<=o;){const s=o+i>>1,a=I(t,n,r,e,17*s);if(a>0)i=s+1;else{if(!(a<0))return[S(e,17*s+7),e.getUint32(17*s+13,!0)];o=s-1}}return null},J=(e,t)=>e.isDir&&!t.isDir?1:!e.isDir&&t.isDir?-1:e.z!==t.z?e.z-t.z:e.x!==t.x?e.x-t.x:e.y-t.y,K=(e,t)=>{const n=e.getUint8(17*t);return{z:127&n,x:j(e,17*t+1),y:j(e,17*t+4),offset:S(e,17*t+7),length:e.getUint32(17*t+13,!0),isDir:n>>7==1}},_=e=>{const t=[],n=new DataView(e);for(let e=0;e<n.byteLength/17;e++)t.push(K(n,e));return q(t)},q=e=>{e.sort(J);const t=new ArrayBuffer(17*e.length),n=new Uint8Array(t);for(let t=0;t<e.length;t++){const r=e[t];let i=r.z;r.isDir&&(i|=128),n[17*t]=i,n[17*t+1]=255&r.x,n[17*t+2]=r.x>>8&255,n[17*t+3]=r.x>>16&255,n[17*t+4]=255&r.y,n[17*t+5]=r.y>>8&255,n[17*t+6]=r.y>>16&255,n[17*t+7]=255&r.offset,n[17*t+8]=255&R(r.offset,8),n[17*t+9]=255&R(r.offset,16),n[17*t+10]=255&R(r.offset,24),n[17*t+11]=255&R(r.offset,32),n[17*t+12]=255&R(r.offset,48),n[17*t+13]=255&r.length,n[17*t+14]=r.length>>8&255,n[17*t+15]=r.length>>16&255,n[17*t+16]=r.length>>24&255}return t},F={getHeader:function(e){return o(this,null,(function*(){const t=yield e.getBytes(0,512e3),n=new DataView(t.data),r=n.getUint32(4,!0),i=n.getUint16(8,!0),o=new TextDecoder("utf-8"),s=JSON.parse(o.decode(new DataView(t.data,10,r)));let a=0;"gzip"===s.compression&&(a=2);let c=0;"minzoom"in s&&(c=+s.minzoom);let l=0;"maxzoom"in s&&(l=+s.maxzoom);let u=0,h=0,f=0,d=-180,g=-85,p=180,y=85;if(s.bounds){const e=s.bounds.split(",");d=+e[0],g=+e[1],p=+e[2],y=+e[3]}if(s.center){const e=s.center.split(",");u=+e[0],h=+e[1],f=+e[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+r,rootDirectoryLength:17*i,jsonMetadataOffset:10,jsonMetadataLength:r,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:c,maxZoom:l,minLon:d,minLat:g,maxLon:p,maxLat:y,centerZoom:f,centerLon:u,centerLat:h,etag:t.etag}}))},getZxy:function(e,t,n,r,i,s,a){return o(this,null,(function*(){let o=yield n.getArrayBuffer(t,e.rootDirectoryOffset,e.rootDirectoryLength,e);1===e.specVersion&&(o=_(o));const c=N(new DataView(o),r,i,s);if(c){let e=(yield t.getBytes(c.offset,c.length,a)).data;const n=new DataView(e);return 31===n.getUint8(0)&&139===n.getUint8(1)&&(e=P(new Uint8Array(e))),{data:e}}const l=((e,t)=>{if(e.byteLength<17)return null;const n=e.byteLength/17,r=K(e,n-1);if(r.isDir){const e=r.z,n=t.z-e;return{z:e,x:Math.trunc(t.x/(1<<n)),y:Math.trunc(t.y/(1<<n))}}return null})(new DataView(o),{z:r,x:i,y:s});if(l){const c=((e,t,n,r)=>{const i=W(e,128|t,n,r);return i?{z:t,x:n,y:r,offset:i[0],length:i[1],isDir:!0}:null})(new DataView(o),l.z,l.x,l.y);if(c){let o=yield n.getArrayBuffer(t,c.offset,c.length,e);1===e.specVersion&&(o=_(o));const l=N(new DataView(o),r,i,s);if(l){let e=(yield t.getBytes(l.offset,l.length,a)).data;const n=new DataView(e);return 31===n.getUint8(0)&&139===n.getUint8(1)&&(e=P(new Uint8Array(e))),{data:e}}}}}))}};function G(e,t){return 4294967296*(t>>>0)+(e>>>0)}function X(e){const t=e.buf;let n=t[e.pos++],r=127&n;return n<128?r:(n=t[e.pos++],r|=(127&n)<<7,n<128?r:(n=t[e.pos++],r|=(127&n)<<14,n<128?r:(n=t[e.pos++],r|=(127&n)<<21,n<128?r:(n=t[e.pos],r|=(15&n)<<28,function(e,t){const n=t.buf;let r=n[t.pos++],i=(112&r)>>4;if(r<128)return G(e,i);if(r=n[t.pos++],i|=(127&r)<<3,r<128)return G(e,i);if(r=n[t.pos++],i|=(127&r)<<10,r<128)return G(e,i);if(r=n[t.pos++],i|=(127&r)<<17,r<128)return G(e,i);if(r=n[t.pos++],i|=(127&r)<<24,r<128)return G(e,i);if(r=n[t.pos++],i|=(1&r)<<31,r<128)return G(e,i);throw new Error("Expected varint not more than 10 bytes")}(r,e)))))}function Q(e,t,n,r){if(0===r){1===n&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);const r=t[0];t[0]=t[1],t[1]=r}}var Y=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function ee(e,t){return o(this,null,(function*(){if(1===t||0===t)return e;if(2===t){if(void 0===globalThis.DecompressionStream)return P(new Uint8Array(e));const t=new Response(e).body;if(!t)throw Error("Failed to read response stream");const n=t.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}throw Error("Compression method not supported")}))}function te(e,t){let n=0,r=e.length-1;for(;n<=r;){const i=r+n>>1,o=t-e[i].tileId;if(o>0)n=i+1;else{if(!(o<0))return e[i];r=i-1}}if(r>=0){if(0===e[r].runLength)return e[r];if(t-e[r].tileId<e[r].runLength)return e[r]}return null}var ne=class{constructor(e,t=new Headers){this.url=e,this.customHeaders=t,this.mustReload=!1;let n="";"navigator"in globalThis&&(n=globalThis.navigator.userAgent||"");const r=n.indexOf("Windows")>-1,i=/Chrome|Chromium|Edg|OPR|Brave/.test(n);this.chromeWindowsNoCache=!1,r&&i&&(this.chromeWindowsNoCache=!0)}getKey(){return this.url}setHeaders(e){this.customHeaders=e}getBytes(e,t,n,r){return o(this,null,(function*(){let i,o;n?o=n:(i=new AbortController,o=i.signal);const s=new Headers(this.customHeaders);let a;s.set("range",`bytes=${e}-${e+t-1}`),this.mustReload?a="reload":this.chromeWindowsNoCache&&(a="no-store");let c=yield fetch(this.url,{signal:o,cache:a,headers:s});if(0===e&&416===c.status){const e=c.headers.get("Content-Range");if(!e||!e.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const t=+e.substr(8);c=yield fetch(this.url,{signal:o,cache:"reload",headers:{range:"bytes=0-"+(t-1)}})}let l=c.headers.get("Etag");if((null==l?void 0:l.startsWith("W/"))&&(l=null),416===c.status||r&&l&&l!==r)throw this.mustReload=!0,new oe(`Server returned non-matching ETag ${r} after one retry. Check browser extensions and servers for issues that may affect correct ETag headers.`);if(c.status>=300)throw Error(`Bad response code: ${c.status}`);const u=c.headers.get("Content-Length");if(200===c.status&&(!u||+u>t))throw i&&i.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield c.arrayBuffer(),etag:l||void 0,cacheControl:c.headers.get("Cache-Control")||void 0,expires:c.headers.get("Expires")||void 0}}))}};function re(e,t){const n=e.getUint32(t+4,!0),r=e.getUint32(t+0,!0);return n*i(2,32)+r}function ie(e){const t={buf:new Uint8Array(e),pos:0},n=X(t),r=[];let i=0;for(let e=0;e<n;e++){const e=X(t);r.push({tileId:i+e,offset:0,length:0,runLength:1}),i+=e}for(let e=0;e<n;e++)r[e].runLength=X(t);for(let e=0;e<n;e++)r[e].length=X(t);for(let e=0;e<n;e++){const n=X(t);r[e].offset=0===n&&e>0?r[e-1].offset+r[e-1].length:n-1}return r}var oe=class extends Error{};var se=class{constructor(e=100,t=!0,n=ee){this.cache=new Map,this.invalidations=new Map,this.maxCacheEntries=e,this.counter=1,this.decompress=n}getHeader(e){return o(this,null,(function*(){const t=e.getKey(),n=this.cache.get(t);if(n)return n.lastUsed=this.counter++,yield n.data;const r=new Promise(((t,n)=>{(function(e,t){return o(this,null,(function*(){const n=yield e.getBytes(0,16384);if(19792!==new DataView(n.data).getUint16(0,!0))throw new Error("Wrong magic number for PMTiles archive");if(function(e){const t=new DataView(e);return 2===t.getUint16(2,!0)?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):1===t.getUint16(2,!0)?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}(n.data)<3)return[yield F.getHeader(e)];const r=function(e,t){const n=new DataView(e),r=n.getUint8(7);if(r>3)throw Error(`Archive is spec version ${r} but this library supports up to spec version 3`);return{specVersion:r,rootDirectoryOffset:re(n,8),rootDirectoryLength:re(n,16),jsonMetadataOffset:re(n,24),jsonMetadataLength:re(n,32),leafDirectoryOffset:re(n,40),leafDirectoryLength:re(n,48),tileDataOffset:re(n,56),tileDataLength:re(n,64),numAddressedTiles:re(n,72),numTileEntries:re(n,80),numTileContents:re(n,88),clustered:1===n.getUint8(96),internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:t}}(n.data.slice(0,127),n.etag),i=n.data.slice(r.rootDirectoryOffset,r.rootDirectoryOffset+r.rootDirectoryLength),o=`${e.getKey()}|${r.etag||""}|${r.rootDirectoryOffset}|${r.rootDirectoryLength}`,s=ie(yield t(i,r.internalCompression));return[r,[o,s.length,s]]}))})(e,this.decompress).then((e=>{e[1]&&this.cache.set(e[1][0],{lastUsed:this.counter++,data:Promise.resolve(e[1][2])}),t(e[0]),this.prune()})).catch((e=>{n(e)}))}));return this.cache.set(t,{lastUsed:this.counter++,data:r}),r}))}getDirectory(e,t,n,r){return o(this,null,(function*(){const i=`${e.getKey()}|${r.etag||""}|${t}|${n}`,s=this.cache.get(i);if(s)return s.lastUsed=this.counter++,yield s.data;const a=new Promise(((i,s)=>{(function(e,t,n,r,i){return o(this,null,(function*(){const o=yield e.getBytes(n,r,void 0,i.etag),s=ie(yield t(o.data,i.internalCompression));if(0===s.length)throw new Error("Empty directory is invalid");return s}))})(e,this.decompress,t,n,r).then((e=>{i(e),this.prune()})).catch((e=>{s(e)}))}));return this.cache.set(i,{lastUsed:this.counter++,data:a}),a}))}getArrayBuffer(e,t,n,r){return o(this,null,(function*(){const i=`${e.getKey()}|${r.etag||""}|${t}|${n}`,o=this.cache.get(i);if(o)return o.lastUsed=this.counter++,yield o.data;const s=new Promise(((o,s)=>{e.getBytes(t,n,void 0,r.etag).then((e=>{o(e.data),this.cache.has(i),this.prune()})).catch((e=>{s(e)}))}));return this.cache.set(i,{lastUsed:this.counter++,data:s}),s}))}prune(){if(this.cache.size>=this.maxCacheEntries){let e,t=1/0;this.cache.forEach(((n,r)=>{n.lastUsed<t&&(t=n.lastUsed,e=r)})),e&&this.cache.delete(e)}}invalidate(e){return o(this,null,(function*(){const t=e.getKey();if(this.invalidations.get(t))return yield this.invalidations.get(t);this.cache.delete(e.getKey());const n=new Promise(((n,r)=>{this.getHeader(e).then((e=>{n(),this.invalidations.delete(t)})).catch((e=>{r(e)}))}));this.invalidations.set(t,n)}))}},ae=class{constructor(e,t,n){this.source="string"==typeof e?new ne(e):e,this.decompress=n||ee,this.cache=t||new se}getHeader(){return o(this,null,(function*(){return yield this.cache.getHeader(this.source)}))}getZxyAttempt(e,t,n,r){return o(this,null,(function*(){const o=function(e,t,n){if(e>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(t>i(2,e)-1||n>i(2,e)-1)throw Error("tile x/y outside zoom level bounds");const r=Y[e];let o=0,s=0,a=0;const c=[t,n];let l=i(2,e)/2;for(;l>0;)o=(c[0]&l)>0?1:0,s=(c[1]&l)>0?1:0,a+=l*l*(3*o^s),Q(l,c,o,s),l/=2;return r+a}(e,t,n),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return F.getZxy(s,this.source,this.cache,e,t,n,r);if(e<s.minZoom||e>s.maxZoom)return;let a=s.rootDirectoryOffset,c=s.rootDirectoryLength;for(let e=0;e<=3;e++){const e=te(yield this.cache.getDirectory(this.source,a,c,s),o);if(!e)return;if(e.runLength>0){const t=yield this.source.getBytes(s.tileDataOffset+e.offset,e.length,r,s.etag);return{data:yield this.decompress(t.data,s.tileCompression),cacheControl:t.cacheControl,expires:t.expires}}a=s.leafDirectoryOffset+e.offset,c=e.length}throw Error("Maximum directory depth exceeded")}))}getZxy(e,t,n,r){return o(this,null,(function*(){try{return yield this.getZxyAttempt(e,t,n,r)}catch(i){if(i instanceof oe)return this.cache.invalidate(this.source),yield this.getZxyAttempt(e,t,n,r);throw i}}))}getMetadataAttempt(){return o(this,null,(function*(){const e=yield this.cache.getHeader(this.source),t=yield this.source.getBytes(e.jsonMetadataOffset,e.jsonMetadataLength,void 0,e.etag),n=yield this.decompress(t.data,e.internalCompression),r=new TextDecoder("utf-8");return JSON.parse(r.decode(n))}))}getMetadata(){return o(this,null,(function*(){try{return yield this.getMetadataAttempt()}catch(e){if(e instanceof oe)return this.cache.invalidate(this.source),yield this.getMetadataAttempt();throw e}}))}getTileJson(e){return o(this,null,(function*(){const t=yield this.getHeader(),n=yield this.getMetadata(),r=1===(i=t.tileType)?".mvt":2===i?".png":3===i?".jpg":4===i?".webp":5===i?".avif":"";var i;return{tilejson:"3.0.0",scheme:"xyz",tiles:[`${e}/{z}/{x}/{y}${r}`],vector_layers:n.vector_layers,attribution:n.attribution,description:n.description,name:n.name,version:n.version,bounds:[t.minLon,t.minLat,t.maxLon,t.maxLat],center:[t.centerLon,t.centerLat,t.centerZoom],minzoom:t.minZoom,maxzoom:t.maxZoom}}))}};const ce=["application/octet-stream","application/x-protobuf","image/png","image/jpeg","image/webp","image/avif"],le=/\/([0-9]+)\/([0-9]+)\/([0-9]+).(mvt|png|jpg|webp|avif)$/,ue=/^pmtiles:\/\//,he=/^http(s?)\/\//,fe={},{fetch:de,XMLHttpRequest:ge}=window,pe=new Proxy(de,{apply:async(e,t,[n,r])=>{let i;if(n instanceof Request){if("GET"!==n.method)return e.call(t,n,r);i=n.url}else i=n.toString();if(!ue.test(i))return e.call(t,n,r);i=i.replace(ue,"").replace(he,"http$1://");let o=i,s=null;if(le.test(i)&&(o=i.replace(le,""),s=i.match(le)?.slice(1).map(Number)),o in fe||(fe[o]=new ae(o)),s){const e=await fe[o].getZxy(...s);if(!e)return new Response(null,{status:404});const t=await fe[o].getHeader();return new Response(e.data,{headers:{"Content-Type":ce[t.tileType]}})}{const e=await fe[o].getTileJson("pmtiles://"+o);return new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json"}})}}});window.fetch=pe,window.XMLHttpRequest=class extends ge{constructor(){let e,t,n,r,i,o;super();let s=null;return new Proxy(this,{get:(a,c)=>"open"===c?(t,n,r=!0,i,o)=>{if("GET"!==t||!ue.test(n))return this.open(t,n,r,i,o);n=n.replace(ue,"").replace(he,"http$1://"),e=n,le.test(n)&&(e=n.replace(le,""),s=n.match(le)?.slice(1).map(Number)||null),e in fe||(fe[e]=new ae(e))}:"send"===c?async a=>{if(!e)return this.send(a);try{const n=new ProgressEvent("load");if(s){const i=await fe[e].getZxy(s[0],s[1],s[2]);i?(o=200,r=i.data):(o=404,r=null),this.dispatchEvent(n),t&&t(n)}else{const r=await fe[e].getTileJson("pmtiles://"+e);o=200,i=JSON.stringify(r),this.dispatchEvent(n),t&&t(n)}}catch(e){console.error(e);const t=new ProgressEvent("error");this.dispatchEvent(t),n&&n(t)}}:"response"===c&&r?r:"responseText"===c&&i?i:"status"===c&&o?o:a[c],set:(e,r,i)=>("onload"===r?t=i:"onerror"===r&&(n=i),e[r]=i,!0)})}},(0,r.Bb)("map","data/protomaps-dark-style.json")}},e=>{e(e.s=1922)}]);
//# sourceMappingURL=pmtiles.js.map